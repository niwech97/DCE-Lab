################################################################################

#                         LEARNING DESIGN TECHNIQUES                           #       

################################################################################

# If you haven't already, read the read.me document in the folder to understand 
# the purpose, design aspects, and terminology used in DCE design. 

#--------------------------Creating Choice Sets--------------------------------#
# To start I will attempt to create a choice set using the mix and match method.
# The following conditions must be met for success:
#  There will be two treatment options 
#  3 attributes with 3 levels each (X(X1,X2,X3),Y(Y1,Y2,Y3),Z(10,20,30)
#  There will be an opt out option 
#  The choice sets will be split into 3 blocks 
#  Seed is set to 123

rd<-rotation.design(
  attribute.names=list(X=c("X1","X2","X3"),
                       Y=c("Y1","Y2","Y3"),
                       Z=c("10","20","30")),
  nalternatives = 2,
  nblocks = 3,
  seed = 123
)


rd
# It worked! but I dont quite understand how to read it...
# It seems to be split into 3 main sections
# In the first section:
#    the first two columns refer to the order and grouping of questions
#    ALT refers to the option #
#    the last three refer to the levels of each attribute for that option for 
#       that choice set
#In the second section:
#    Okay this clearly relates to which questions the participants should answer,
#       but I really don't understand how yet...
#    Okay solved it, this is additional information that will inform the order
#       of questions asked (3 variations to avoid order bias)
#In the third section:
#    This is just some basic info that we input into the function,
#       # of blocks, # of questions in the blocks, # of options, # of attributes


#--------------------------Creating the Questionnaire--------------------------#
#Now that the Choice sets have been designed with the appropriate attributes and
#levels, we can create the questionnaire.

questionnaire(choice.experiment.design = rd)

# Wow another first try success!
# This function spits out the exact questions that should be asked within each
# block. Each question is a choice between two options that are characterized by 
# the attributes and levels specified, typically a respondent will be asked
# to respond to only one block of questions. 

# This is clearly a super simple way to create a questionnaire that can be 
# edited in a word processor to make a distributable questionnaire.


#-----------------------------Creating a Matrix--------------------------------#
# It may not seem important to be able to turn this design into a matrix, but by
# trasforming the design into a matrix, we can perform Conditional Logit Analysis
# or Binomial Logit Analysis. 

# an important note is that this function can account for continuos or 
# categorical cariables as well as account for opt out options and more

# With that in mind lets create a matrix such that:
# We use rd (created above)
# an opt out option is present and visible
# Each alternative has 3 attributes, X and Y are categorical and Z is continuous

dm.rd<-make.design.matrix(
  choice.experiment.design = rd,
  optout=TRUE,
  categorical.attributes = c("X","Y"),
  continuous.attributes = c("Z"),
  unlabeled = TRUE,
  common = NULL,
  binary = FALSE)

dm.rd

# This matrix shows the order of the questions/options including an opt out option every 
# 3rd line. 
# The first 3 columns like previously refer to the block#, question#,
# and option# with 3 being the opt out choice. 
# 
# The next four columns are binary.
# ASC refers to whether it is an alternative or the opt out option. X2 and X3 
# refer to the possible levels existing in attribute X for that treatment, a 0 
# in both X2 and X3 means X1 (a nonexistant column that would have referred to
# the first level in attribute X) would have a 1. The same for Y2 and Y3. 
# 
# Z is the last column and as this is our continuous variable, the number 
# refers to the value of the variable. 

# Again this matrix is not used in design as much as it is in the analysis, but 
# you must be able to design the matrix in order to apply the CL or BL analysis.


